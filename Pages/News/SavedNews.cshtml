@page "/SavedNews"
@model EHS_Benjamin_Pasic.Pages.News.SavedNewsModel
@{
    ViewData["Title"] = "Saved News";
}

<h2 class="page-title">Saved News</h2>

@if (Model.SavedNews == null || !Model.SavedNews.Any())
{
    <p class="empty-text">You haven’t saved any articles yet.</p>
}
else
{
    <div class="saved-list">
        @foreach (var item in Model.SavedNews)
        {
            <div class="saved-item-card">
                <img class="saved-thumb"
                     src="@(!string.IsNullOrEmpty(item.ImageUrl) ? item.ImageUrl : "/images/no-image.png")"
                     alt="News Image" />

                <div class="saved-content">

                    <h4 class="saved-title">
                        <a href="@item.Url" target="_blank">@item.Title</a>
                    </h4>

                    <div class="saved-meta">
                        <span class="saved-category">
                            @EHS_Benjamin_Pasic.Pages.News.SavedNewsModel.FormatCategory(item.Category)
                        </span>

                        <span class="saved-date">
                            @item.PublishedAt.ToString("yyyy-MM-dd HH:mm")
                        </span>
                    </div>

                    <div class="saved-actions">
                        <a class="btn view-btn"
                           asp-page="/News/Details"
                           asp-route-articleId="@item.ArticleId">
                            <i class="bi bi-eye"></i> View
                        </a>

                        <button class="btn remove-btn delete-btn"
                                data-id="@item.ArticleId">
                            <i class="bi bi-trash"></i> Remove
                        </button>
                    </div>
                </div>
            </div>
        }
    </div>

}



@section Scripts {
    <script>
        let deleteId = null;
        let deleteRow = null;

        $(document).on("click", ".delete-btn", function () {
            deleteId = $(this).attr("data-id");
            deleteCard = $(this).closest(".saved-item-card");
            if (!deleteCard || deleteCard.length === 0) {
                deleteCard = $('.saved-item-card').filter(function () {
                    return $(this).find('[data-id="' + deleteId + '"]').length > 0;
                }).first();
            }

            const modal = new bootstrap.Modal(document.getElementById("deleteConfirmModal"));
            modal.show();
        });

        $(document).on("click", "#confirmDeleteBtn", function () {
            if (!deleteId) return;

            $.ajax({
                url: "/api/NewsApi/delete/" + deleteId,
                type: "DELETE",
                success: function (res) {
                    deleteCard.remove();
                    showToast(res.msg, "success");
                    if ($('.saved-item-card').length === 0) {
                        $('.saved-list').html('<p class="empty-text">You haven’t saved any articles yet.</p>');
                    }
                    deleteId = null;
                    deleteCard = null;
                },
                error: function () {
                    showToast("Error deleting article.", "danger");
                }
            });

            const modalEl = document.getElementById("deleteConfirmModal");
            bootstrap.Modal.getInstance(modalEl).hide();
        });
    </script>
}



