@page "/SavedNews"
@model EHS_Benjamin_Pasic.Pages.News.SavedNewsModel
@{
    ViewData["Title"] = "Saved News";
}

<h2 class="page-title">Saved News</h2>

@if (Model.SavedNews == null || !Model.SavedNews.Any())
{
    <p class="empty-text">No saved articles.</p>
}
else
{
    <div class="table-responsive">
        <table class="table saved-table">
            <thead>
                <tr>
                    <th>Image</th>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Published</th>
                    <th>See Details</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.SavedNews)
                {
                    <tr>
                        <td>
                            <img src="@(!string.IsNullOrEmpty(item.ImageUrl) ? item.ImageUrl : "/images/no-image.png")"
                                 alt="Image" width="100" class="thumb-img" />
                        </td>
                        <td class="news-title">
                            <a href="@item.Url" target="_blank">@item.Title</a>
                        </td>
                        <td>@EHS_Benjamin_Pasic.Pages.News.SavedNewsModel.FormatCategory(item.Category)</td>
                        <td>@item.PublishedAt.ToString("yyyy-MM-dd HH:mm")</td>
                        <td>
                            <a class="btn details-btn"
                               asp-page="/News/Details"
                               asp-route-articleId="@item.ArticleId">
                                View
                            </a>
                        </td>
                        <td>
                            <button class="btn delete-btn" data-id="@item.ArticleId">
                                Delete
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}


@section Scripts {
    <script>
        $(document).on("click", ".delete-btn", function () {
            if (!confirm("Delete this article?")) return;

            var id = $(this).attr("data-id");
            var row = $(this).closest("tr");

            $.ajax({
                url: "/api/NewsApi/delete/" + id,
                type: "DELETE",
                success: function (res) {
                    alert(res.msg);
                    row.remove();
                },
                error: function (err) {
                    console.log("Delete error:", err);
                    alert("Error deleting article.");
                }
            });
        });
    </script>
}

