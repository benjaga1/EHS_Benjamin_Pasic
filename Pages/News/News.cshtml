@page "/News"
@model EHS_Benjamin_Pasic.Pages.News.NewsModel
@{
    ViewData["Title"] = "Health News";
}

<h2 class="fw-bold mb-3" style="color:#333;">Health News</h2>

@if (Model.News == null || !Model.News.Any())
{
    <p>No news available.</p>
}
else
{
    <div class="mb-4 d-flex flex-wrap gap-2">
        @foreach (var category in new[] { "Health", "Technology", "Sports", "Business", "Science" })
        {
            var isActive = string.Equals(category.ToLower(), Model.CurrentCategory, StringComparison.OrdinalIgnoreCase);
            <button class="category-btn @(isActive ? "active" : "")" data-category="@category.ToLower()">
                @category
            </button>
        }
    </div>

    <div id="news-container">
        @await Html.PartialAsync("_NewsListPartial", Model.News)
    </div>

}

@section Scripts {
    <script>
                $(document).on("click", ".category-btn", function () {
            $(".category-btn").removeClass("active");
            $(this).addClass("active");

            var category = $(this).data("category");
            $.get(`/News?handler=NewsPartial&category=${category}`, function (data) {
                $("#news-container").html(data);
            });
        });


        $(document).on("click", ".save-btn", function () {
            var rawJson = $(this).attr("data-article");
            var obj = JSON.parse(rawJson);

            $(this).toggleClass("saved");

            console.log("Raw Data being sent to API:", rawJson);
            console.log("Data being sent to API:", obj);

            $.ajax({
                url: "/api/NewsApi/save",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(obj),
                success: function(res) {
                    alert(res.msg);
                },
                error: function(err) {
                    console.log("AJAX error:", err);
                    alert("Error saving news.");
                }
            });
        });

        function showToast(msg) {
            let t = document.createElement("div");
            t.className = "toast-popup";
            t.innerText = msg;

            document.body.appendChild(t);

            setTimeout(() => t.style.opacity = "1", 50);
            setTimeout(() => {
                t.style.opacity = "0";
                setTimeout(() => t.remove(), 300);
            }, 2000);
        }

    </script>
}

